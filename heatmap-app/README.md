# Тепловая карта инцидентов

Приложение для визуализации инцидентов на карте с использованием тепловых зон. Позволяет отслеживать концентрацию происшествий в различных районах города.

## Структура проекта

```
src/
├── components/
│   └── YandexHeatMap/
│       ├── index.jsx         # Основной компонент карты
│       ├── ZoneCircle.jsx    # Компонент для отрисовки зон
│       └── ZoneTooltip.jsx   # Компонент всплывающих подсказок
├── hooks/
│   ├── useMapZoom.js        # Хук для управления зумом
│   └── useZones.js          # Хук для управления зонами
└── utils/
    ├── mapCalculations.js   # Утилиты для расчетов
    └── zoneStyles.js        # Стили и цвета зон
```

## Основные модули

### 1. Представление (View Layer)

#### `YandexHeatMap/index.jsx`
Основной компонент, который объединяет все части приложения:
- Инициализация карты Яндекс
- Управление состоянием карты
- Обработка событий (наведение, клик)
- Координация между компонентами

#### `ZoneCircle.jsx`
Отвечает за отрисовку отдельной зоны на карте:
- Визуализация круга с динамическим радиусом
- Применение стилей в зависимости от количества инцидентов
- Обработка интерактивности

#### `ZoneTooltip.jsx`
Отображает информацию при наведении на зону:
- Детали о количестве инцидентов
- Список всех происшествий в зоне
- Динамическое позиционирование

### 2. Бизнес-логика (Business Layer)

#### `useZones.js`
Ключевой хук для управления бизнес-логикой зон:
```javascript
const { zones } = useZones(incidents, currentZoom);
```
Основные функции:
- Группировка инцидентов по адресам
- Объединение пересекающихся зон
- Расчет метрик для каждой зоны:
  - Количество уникальных адресов
  - Общее количество инцидентов
  - Определение центра группы

#### `mapCalculations.js`
Математические расчеты для карты:
```javascript
// Расчет радиуса круга
const radius = calculateCircleRadius(count, zoom);
// Расчет расстояния между точками
const distance = calculateDistance(point1, point2);
// Определение максимального расстояния для объединения
const maxDistance = getMaxMergeDistance(zoom);
```

### 3. Стилизация и визуализация (Styling Layer)

#### `zoneStyles.js`
Управление внешним видом зон:
```javascript
const ZONE_COLORS = {
  level1: '#2563eb', // Безопасно
  level6: '#dc2626'  // Опасно
};
```
- Определение цветов для разных уровней опасности
- Расчет прозрачности
- Настройка стилей обводки

## Как это работает

1. **Инициализация**:
   - Компонент получает массив инцидентов
   - Создается карта с начальными настройками
   - Устанавливается начальный зум

2. **Обработка данных**:
   - Инциденты группируются по адресам
   - Создаются базовые зоны
   - Происходит объединение близких зон

3. **Визуализация**:
   - Для каждой зоны вычисляется:
     - Радиус (на основе количества адресов и зума)
     - Цвет (на основе количества инцидентов)
     - Прозрачность
   - Отрисовываются круги на карте

4. **Интерактивность**:
   - При наведении показывается детальная информация
   - При изменении зума пересчитываются размеры
   - При добавлении нового инцидента происходит обновление

## Алгоритм объединения зон

1. **Базовая группировка**:
   ```javascript
   const zonesByAddress = new Map();
   incidents.forEach(incident => {
     const key = incident.address;
     // Группировка по адресам
   });
   ```

2. **Объединение близких зон**:
   ```javascript
   const maxMergeDistance = getMaxMergeDistance(zoom);
   // Если расстояние между зонами меньше maxMergeDistance,
   // они объединяются в одну тепловую зону
   ```

3. **Расчет параметров зоны**:
   - Центр: среднее значение координат всех точек
   - Размер: зависит от количества уникальных адресов
   - Цвет: зависит от общего количества инцидентов

## Оптимизация

1. **Производительность**:
   - Мемоизация компонентов через React.memo
   - Использование useCallback для обработчиков
   - Эффективная группировка данных

2. **Визуализация**:
   - Динамический расчет размеров
   - Плавное масштабирование
   - Оптимизированные стили

## Масштабируемость

Архитектура позволяет легко добавлять новые функции:
- Новые типы визуализации
- Дополнительные метрики
- Расширенная фильтрация
- Кастомизация стилей
